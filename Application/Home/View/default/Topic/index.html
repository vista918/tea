<extend name="Base/common"/>

<block name="stylex">
</block>
	
<block name="script">
    <script type="text/javascript">	 
		
    $(function () {
		var totaltopic = <?php echo json_encode($totaltopic)?>;	//待审核
		var countoftotaltopic = totaltopic.length;
		var data0 = new Array(countoftotaltopic);
		
		
		for(i = 0; i < countoftotaltopic; ++i)
		{
			var newDate = new Date();	
			newDate.setTime(totaltopic[i].topictime*1000);	
			data0[i] = new Array();		
			
			data0[i][0] = totaltopic[i].goodsid;
			data0[i][1] = totaltopic[i].buyerid;
			data0[i][2] = totaltopic[i].topiccontent;
			data0[i][3] = newDate.format('yyyy-MM-dd hh:mm:ss');
			data0[i][4] = totaltopic[i].isshow;
			data0[i][5] = "";
		}			
			
        function getRowIndx() {
            var arr = $grid.pqGrid("selection", { type: 'row', method: 'getSelection' });
            if (arr && arr.length > 0) {
                return arr[0].rowIndx;                                
            }
            else {
                alert("Select a row.");
                return null;
            }
        }

        var obj = { 
			width: 1200,
			height: 600,
			title: "评论列表",
			resizable:false,
			draggable:true ,
			refresh: function () {
                $("#grid_array").find("button.delete_btn").button({ icons: { primary: 'ui-icon-scissors'} })
                .unbind("click")
                .bind("click", function (evt) {
                    var $tr = $(this).closest("tr");
                    var obj = $grid.pqGrid("getRowIndx", { $tr: $tr });
                    var rowIndx = obj.rowIndx;
                    $grid.pqGrid("addClass", { rowIndx: rowIndx, cls: 'pq-row-delete' });

                    var ans = window.confirm("Are you sure to delete row No " + (rowIndx + 1) + "?");

                    if (ans) {
                        $grid.pqGrid("deleteRow", { rowIndx: rowIndx, effect: true, complete: function () {
                            $grid.pqGrid("removeClass", { rowIndx: rowIndx, cls: 'pq-row-delete' });
                        }
                        });
                    }
                    else {
                        $grid.pqGrid("removeClass", { rowIndx: rowIndx, cls: 'pq-row-delete' });
                    }
                });
            },
		};
        obj.colModel = 
		[
			{ title: "商品信息", width: 100, dataType: "string" , align: "center"},
			{ title: "客户", width: 100, dataType: "string" , align: "center"},
			{ title: "评论内容", width: 200, dataType: "string", align: "center" },
			{ title: "评价时间", width: 150, dataType: "string", align: "center"},
			{ title: "显示", width: 60, dataType: "string", align: "center" },
			{ title: "回复内容", width: 160, dataType: "string", align: "center"},
			{ title: "操作", editable: false, minWidth: 83, sortable: false, render: function (ui) {
				return "<button type='button' class='delete_btn'>Delete</button>";}
			}
		];
        obj.dataModel = { data: data0 };
        $grid = $("#grid_array").pqGrid(obj);
        var grid = $grid.data("paramqueryPqGrid");
    });    
    </script>
</block>

<block name="stylex">	
	<style type="text/css">	
	.gridcss {
	  position:absolute;
	  left:0px;
	  top:40px;
	}
	button.delete_btn
	{
		margin:-3px 0px;
	}
	tr.pq-row-delete
	{
		text-decoration:line-through;         
	}
	tr.pq-row-delete td
	{
		background-color:pink;   
	}
	</style>
</block>

<block name="side">
<!-- 左侧 nav
==================================================
    <div class="span3 bs-docs-sidebar">
        <ul class="nav nav-list bs-docs-sidenav">
            {:W('Category/lists', array(1, true))}
        </ul>
    </div> -->
</block>

<block name="body">   	
	<div id="grid_array" class = "gridcss" ></div>   
</block>
